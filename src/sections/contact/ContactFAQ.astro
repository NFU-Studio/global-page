---
import { spring } from "motion";
import { ChevronDown } from "lucide-react";
import Typography from "@/components/ui/Typography.astro";
import { contactFaqData } from "@/data/contact-faq";
import { generateFAQPageJSON_LD } from "@/lib/structured-data";

const structuredData = generateFAQPageJSON_LD(contactFaqData);
---

<script>
  // Simple FAQ accordion functionality
  const faqItems = document.querySelectorAll("[data-faq-item]");
  faqItems.forEach((item) => {
    const button = item.querySelector("[data-faq-button]");
    const content = item.querySelector("[data-faq-content]");
    const icon = item.querySelector("[data-faq-icon]");

    button?.addEventListener("click", () => {
      const isOpen = item.getAttribute("data-faq-open") === "true";

      // Close all other items
      faqItems.forEach((otherItem) => {
        if (otherItem !== item) {
          otherItem.setAttribute("data-faq-open", "false");
          const otherIcon = otherItem.querySelector("[data-faq-icon]");
          otherIcon?.setAttribute("data-rotated", "false");
        }
      });

      // Toggle current item
      item.setAttribute("data-faq-open", (!isOpen).toString());
      icon?.setAttribute("data-rotated", (!isOpen).toString());
    });
  });
</script>

<style define:vars={{ springTiming: spring(0.4, 0.26) }}>
  [data-faq-content] {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows var(--springTiming);
  }

  [data-faq-item][data-faq-open="true"] [data-faq-content] {
    grid-template-rows: 1fr;
  }

  [data-faq-content-inner] {
    overflow: hidden;
  }

  [data-faq-icon] {
    transition: transform var(--springTiming);
  }

  [data-faq-icon][data-rotated="true"] {
    transform: rotate(180deg);
  }
</style>

<script type="application/ld+json" set:html={JSON.stringify(structuredData)} />

<section class="p-rws space-y-6 grid lg:grid-cols-2 gap-rws">
  <header>
    <Typography as="h2" variant="h2l">
      FAQ — najczęściej zadawane pytania
    </Typography>
  </header>

  <div class="space-y-3">
    {
      contactFaqData.map((item, index) => (
        <div
          data-faq-item
          data-faq-open="false"
          class="border border-foreground/10 rounded-lg bg-background overflow-hidden">
          <button
            data-faq-button
            class="w-full flex items-center justify-between p-5 text-left focus-within:bg-foreground/5 hover:bg-foreground/5 transition-colors">
            <span class="font-medium pr-4">{item.q}</span>
            <ChevronDown data-faq-icon className="size-5 shrink-0" />
          </button>
          <div data-faq-content>
            <div data-faq-content-inner class="">
              <Typography mw="p" class="text-muted-foreground p-5">
                {item.a}
              </Typography>
            </div>
          </div>
        </div>
      ))
    }
  </div>
</section>
